<md-toolbar color="secondary">
  <span fxFlex="1 0 auto">{{ project?.name }} - {{ suite?.name }}</span>
  <md-menu #menu="mdMenu">
    <button md-menu-item (click)="openUpdateDialog()"><md-icon>mode_edit</md-icon> Edit Suite</button>
    <button md-menu-item><md-icon>directions_run</md-icon>Trigger test run</button>
  </md-menu>
  <button md-icon-button [mdMenuTriggerFor]="menu"><md-icon>more_vert</md-icon></button>
</md-toolbar>

<md-tab-group [(selectedIndex)]="activeTabIndex">
  <md-tab label="Test Results">
    <md-card *ngFor="let result of results | async; let index = index" (click)="openDetails(result)" class="linked">
      <md-card-header>
        <div mdCardAvatar [ngClass]="result.status">
          <md-icon *ngIf="result.status == 'successful'">check</md-icon>
          <md-icon *ngIf="result.status == 'error'">error</md-icon>
          <md-icon *ngIf="result.status == 'failed'">clear</md-icon>
          <md-icon *ngIf="result.status == 'partial'">clear</md-icon>
          <md-icon *ngIf="result.status == 'skipped'">skip_next</md-icon>
          <md-icon *ngIf="result.status == 'running'">directions_run</md-icon>
          <md-icon *ngIf="result.status == 'scheduled'">alarm</md-icon>
        </div>
        <md-card-title>{{ result.date | date:'medium' }}</md-card-title>
        <md-card-subtitle>{{ result._id }}</md-card-subtitle>
      </md-card-header>
    </md-card>

    <md-paginator [length]="length | async" [pageSize]="10" [pageSizeOptions]="[ 5, 10, 25, 100 ]"></md-paginator>
  </md-tab>
  <md-tab label="Configuration">
    <md-card>
      <md-card-content>
        <dl>
          <dt>Glob</dt>
          <dd>
            <ng-container *ngFor="let glob of suite?.glob">{{ glob }}<br /></ng-container>
          </dd>
          <dt>Browsers</dt>
          <dd>
            <ng-container *ngFor="let browser of suite?.browsers">{{ browser }}<br /></ng-container>
          </dd>
        </dl>
        <dl>
          <dt>skipJsErrors</dt>
          <dd>{{ suite?.options?.skipJsErrors | json }}</dd>
          <dt>quarantineMode</dt>
          <dd>{{ suite?.options?.quarantineMode | json }}</dd>
          <dt>selectorTimeout</dt>
          <dd>{{ suite?.options?.selectorTimeout | json }}</dd>
          <dt>assertionTimeout</dt>
          <dd>{{ suite?.options?.assertionTimeout | json }}</dd>
          <dt>speed</dt>
          <dd>{{ suite?.options?.speed | json }}</dd>
        </dl>
      </md-card-content>
    </md-card>

  </md-tab>

  <md-tab *ngFor="let detail of details; let index = index">
    <div *mdTabLabel>
      <button md-icon-button (click)="closeDetails(index);$event.stopImmediatePropagation()"><md-icon>clear</md-icon></button>
      {{ detail.label }}
      </div>
    <md-card>
      <md-card-content>
        <p>Status: {{ detail.result.status }}</p>
        <ng-container *ngFor="let fixture of detail.result.result?.fixtures">
          <h3>{{ fixture.name }} <img src="/{{detail.result.project | encodeUriComponent}}/s/{{detail.result.suite | encodeUriComponent}}/f/{{fixture.name | encodeUriComponent}}/{{detail.result._id}}/batch.svg" [alt]="fixture.name"/></h3>

          <ng-container *ngFor="let test of fixture.tests">
            <md-expansion-panel>
              <md-expansion-panel-header>
                <md-panel-title>{{ test.name }}</md-panel-title>
                <md-panel-description><img src="/{{detail.result.project | encodeUriComponent}}/s/{{detail.result.suite | encodeUriComponent}}/f/{{fixture.name | encodeUriComponent}}/t/{{test.name | encodeUriComponent}}/{{detail.result._id}}/batch.svg" [alt]="test.name" /></md-panel-description>
              </md-expansion-panel-header>

              <p>Duration: {{ test.durationMs }}</p>
              <barista-testcafe-error *ngFor="let error of test.errs" [error]="error"></barista-testcafe-error>
              <!--<pre *ngFor="let error of test.errs">{{error}}</pre>-->
            </md-expansion-panel>
          </ng-container>
        </ng-container>
      </md-card-content>
    </md-card>
  </md-tab>
</md-tab-group>
